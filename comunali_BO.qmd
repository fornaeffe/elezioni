---
title: "Elezioni del comune di Bologna 2027"
author: "Luca Fornasari"
date: "`r Sys.Date()`"
format: 
  html:
    self-contained: true
---

```{r setup}
#| include: false
knitr::opts_chunk$set(echo = FALSE)

source("R/caricamento_dati.R")
source("R/generazione_voti.R")
source("R/scrutinio_comunali.R")
source("R/simula_comunali.R")
source("R/presentazione_risultati.R")

comune <- "Bologna"

scenario <- "scenari/BO_soli.xlsx"

data_elezione <- as.POSIXct("2027-03-01")

```

```{r simulazione}
#| include: false

risultato <- simula_comunali(comune, scenario, data_elezione)

```

## Dati
```{r}
tabella_dati(risultato)
```

### Percentuali per lista

Questo grafico mostra le percentuali simulate per ciascuna 
lista.
```{r}
boxplot_percentuali(risultato)
```

### Coalizioni vincenti

```{r vincenti}

coalizioni_vincenti(risultato)

```

### Composizione del Consiglio comunale

```{r plot_consiglio_comunale}
#| warning: false 

plot_consiglio_comunale(risultato)

```

### Probabilità di eleggere qualcuno

```{r}
superamento_soglia_comunali(risultato)
```

### Numero di seggi rispetto alle percentuali ottenute



```{r}
eletti_percentuale_xyplots_liste(risultato)
eletti_percentuale_xyplots_coalizioni_comunali(risultato)
```

Nei grafici seguenti ogni colonna rappresenta i numeri di seggi che la lista può
ottenere se prende una percentuale compresa tra i due estremi della colonna.
Ad esempio, se la colonna tra le percentuali 3 e 4 comprende due celle di 
dimensioni simili, con scritto 1 e 2, significa che se la lista prende tra il 3%
e il 4% può eleggere uno o due consiglieri, e queste due possibilità hanno 
probabilità simili. Ad area uguale corrisponde una uguale probabilità di ottenere
quei risultati.

I grafici relativi ai candidati sindaco indicano con quale percentuale (dei voti
validi al candidato sindaco) possono essere eletti come sindaco o come consigliere.

```{r}
grafici_eletti_comunali(risultato)
```

### Probabilità di elezione per ciascuna posizione

```{r}
disegna_tabella_prob_comunali(risultato)
```

# Approfondimenti

{{< include _spiegazione_metodo.qmd >}}

```{r}
#| fig.width: 8
#| fig-height: 8
#| dpi: 100


par(mar=c(15.1, 4.1, 4.1, 2.1), xpd=TRUE)
andamento_passato(risultato)
```

